version: "3.8"

services:
  hue:
    image: gudari/hue:<%= version %>
    container_name: hue
    hostname: hue
    environment:
      SERVICE_PRECONDITION: "namenode-0:50070 datanode-0:50075"
    depends_on:
      - namenode-0
    env_file:
    - hue.env

  namenode-0:
    image: gudari/hadoop:<%= hadoop_version %>
    container_name: namenode-0
    hostname: namenode-0
    volumes:
      - ./storage/namenode:/hadoop/dfs/name
    environment:
      - CLUSTER_NAME=local
    env_file:
      - ./hadoop.env

  datanode-0:
    image: gudari/hadoop:<%= hadoop_version %>
    container_name: datanode-0
    hostname: datanode-0
    volumes:
      - ./storage/datanode:/hadoop/dfs/data
    environment:
      SERVICE_PRECONDITION: "namenode-0:50070"
    depends_on:
      - namenode-0
    env_file:
      - ./hadoop.env

  hoster:
    image: dvdarias/docker-hoster
    container_name: hadoop_hoster
    hostname: hue_hoster
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock
      - /etc/hosts:/tmp/hosts